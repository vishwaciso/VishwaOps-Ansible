<!-- HEADER -->
<p align="center">
  <img src="https://capsule-render.vercel.app/api?type=waving&color=0:0A192F,100:1E90FF&height=200&section=header&text=🧩%20Ansible%20Roles%20Explained%20(+%20Role%20Dependencies%20%26%20Playbook%20Includes)&fontSize=30&fontColor=ffffff&animation=twinkling"/>
</p>

<p align="center">
  <img src="https://readme-typing-svg.herokuapp.com?duration=3500&pause=800&color=1E90FF&center=true&vCenter=true&width=980&lines=Understanding+Ansible+Roles;Why+Roles%2C+What+they+Contain%2C+How+to+Use+Them;Calling+One+Role+from+Another+%7C+Including+Playbooks"/>
</p>

<p align="center">
  <img src="https://img.shields.io/badge/Automation-Ansible-blue?style=for-the-badge&logo=ansible&logoColor=white"/>
  <img src="https://img.shields.io/badge/Language-YAML-1572B6?style=for-the-badge&logo=yaml&logoColor=white"/>
</p>

---

## ⚙️ What are Ansible Roles?
> **Definition:** An **Ansible Role** is a standardized folder structure for packaging reusable automation (tasks, handlers, templates, variables, files) so large playbooks stay clean, modular, and collaborative.

**Why Roles?**
- ♻️ Reuse automation across many projects/environments
- 🧭 Organize logic by responsibility (web, db, security, monitoring)
- 👥 Enable team ownership per role
- 🧰 Reduce duplication; improve readability and testing

---

## 🧱 Role Structure (generated by `ansible-galaxy init <role>`)
```
roles/
  webserver/
    tasks/
      main.yml
    handlers/
      main.yml
    templates/
      nginx.conf.j2
    files/
      index.html
    vars/
      main.yml
    defaults/
      main.yml
    meta/
      main.yml
```
**What each folder is for**
| Folder | Purpose | Typical content |
|---|---|---|
| `tasks/` | Main steps the role performs | install/configure/start service |
| `handlers/` | Triggered actions (notify -> restart) | restart services |
| `templates/` | Jinja2 templates (dynamic config) | `nginx.conf.j2` |
| `files/` | Static files to copy | certs, unit files |
| `vars/` | Higher-priority vars | env-specific values |
| `defaults/` | Lowest-priority defaults | ports, paths |
| `meta/` | Role metadata & **dependencies** | role deps, author, license |

---

## 🚀 Create and Use a Role
**Create**
```bash
ansible-galaxy init webserver
```
**Define tasks** – `roles/webserver/tasks/main.yml`
```yaml
- name: Install Nginx
  apt:
    name: nginx
    state: present
  when: ansible_os_family == "Debian"

- name: Deploy nginx.conf
  template:
    src: nginx.conf.j2
    dest: /etc/nginx/nginx.conf
  notify: Restart nginx

- name: Ensure Nginx running
  service:
    name: nginx
    state: started
    enabled: true
```
**Handler** – `roles/webserver/handlers/main.yml`
```yaml
- name: Restart nginx
  service:
    name: nginx
    state: restarted
```
**Use the role in a playbook**
```yaml
- name: Apply web stack
  hosts: web
  become: yes
  roles:
    - webserver
```

---

## 🧩 Calling **One Role from Another**
There are **two** common ways:

### 1) Role **Dependencies** (recommended for static, always-needed deps)
Declare in **`meta/main.yml`** of the **parent** role:
```yaml
# roles/webserver/meta/main.yml
dependencies:
  - role: common      # runs before this role
  - role: firewall
    vars:
      allow_http: true
```
> Use this when the parent role **always** needs the other role(s).

### 2) Dynamically include another role from **tasks** (conditional / tagged)
Use `import_role` (static at parse time) or `include_role` (dynamic at run time).

```yaml
# roles/webserver/tasks/main.yml
- name: Always import hard dependency (parsed at start)
  import_role:
    name: common

- name: Conditionally include monitoring role
  include_role:
    name: monitoring
  when: enable_monitoring | default(false)

- name: Include firewall with custom vars
  include_role:
    name: firewall
  vars:
    allow_http: true
    allow_https: true
  tags: firewall
```
**When to choose which?**
- `meta/dependencies`: simple, fixed dependency chain, runs before role
- `import_role`: parsed early; good for predictable structure
- `include_role`: evaluated during execution; good with `when`, `loop`, `tags`

---

## 📦 Passing Variables Between Roles
- Use **role defaults** (`defaults/main.yml`) for safe, overridable values
- Use **role vars** (`vars/main.yml`) sparingly (higher precedence)
- Pass vars **at call time** via `include_role` or via the **parent playbook**:
```yaml
- hosts: web
  roles:
    - role: webserver
      vars:
        web_listen_port: 80
```
> Prefer defaults + playbook vars to keep roles reusable.

---

## 🔗 Including **One Playbook from Another**
Sometimes you want a **master** playbook that stitches other playbooks together.

### Option A — `import_playbook` (static, parsed at start)
Top-level **site.yml**:
```yaml
# site.yml
- import_playbook: plays/common.yml
- import_playbook: plays/web.yml
- import_playbook: plays/db.yml
```
> Use this for a predictable, always-same composition.

### Option B — `include_tasks` / `import_tasks` from inside a play
Inside a play’s `tasks` you can include task files:
```yaml
- hosts: all
  tasks:
    - import_tasks: tasks/preflight.yml    # static
    - include_tasks: tasks/conditional.yml # dynamic with when/loop
      when: run_conditional | default(false)
```
> `import_*` = static (parsed at start) • `include_*` = dynamic (runtime).

---

## 🧠 When to Use Roles vs. Just Playbooks
| Situation | Use Roles? | Reason |
|---|---|---|
| Single-use, tiny automation | Not required | Keep it simple |
| Repeated across teams/envs | ✅ Yes | Reuse + consistency |
| Long playbooks getting messy | ✅ Yes | Structure & clarity |
| CI/CD pipelines | ✅ Yes | Modularity + testing |
| Need dependencies between components | ✅ Yes | Use `meta/dependencies` |

---

## 🧾 Best Practices
- Keep roles **small and focused** (one responsibility)
- Prefer **defaults** over **vars**; document variables in `README.md`
- Use **handlers** only for real change notifications
- Put environment secrets in **Ansible Vault**
- Add **tags** to long roles for selective runs (`--tags firewall`)
- Test roles standalone with **molecule** (optional, advanced)

---

## 💬 In Short
> “Roles turn big playbooks into clean, reusable building blocks.  
> Chain roles via `meta/dependencies` or `include_role`, and orchestrate whole systems with `import_playbook`.”

---

<p align="center">
  <img src="https://capsule-render.vercel.app/api?type=waving&color=0:1E90FF,100:0A192F&height=140&section=footer"/>
</p>
